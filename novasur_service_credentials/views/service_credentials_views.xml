<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- 游댳 Men칰 ra칤z -->
        <menuitem id="menu_novasur_services_root"
                  name="Servicios Digitales"
                  sequence="10"
                  groups="sales_team.group_sale_manager"/>

        <!-- 游댳 Acci칩n principal -->
        <record id="action_service_credentials" model="ir.actions.act_window">
            <field name="name">Credenciales de Servicios</field>
            <field name="res_model">service.credentials</field>
            <field name="view_mode">kanban,list,form</field>
            <field name="context">{'search_default_available': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Crear una nueva credencial de servicio digital
                </p>
                <p>
                    Gestiona las credenciales de tus servicios digitales como Spotify, Netflix, YouTube, etc.
                </p>
            </field>
        </record>

        <!-- 游댳 Submen칰 -->
        <menuitem id="menu_service_credentials"
                  name="Credenciales"
                  parent="menu_novasur_services_root"
                  action="action_service_credentials"
                  sequence="10"
                  groups="sales_team.group_sale_manager"/>

        <!-- 游댳 Vista Kanban -->
        <record id="view_service_credentials_kanban" model="ir.ui.view">
            <field name="name">service.credentials.kanban</field>
            <field name="model">service.credentials</field>
            <field name="arch" type="xml">
                <kanban default_group_by="state" class="o_kanban_small_column">
                    <field name="login"/>
                    <field name="product_id"/>
                    <field name="state"/>
                    <field name="partner_id"/>
                    <field name="assign_date"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <div class="o_kanban_record_headings">
                                    <strong><field name="login"/></strong>
                                    <div class="text-muted">
                                        <field name="product_id"/>
                                    </div>
                                </div>
                                <span class="badge"
                                      t-attf-class="badge-{{record.state.raw_value == 'available' ? 'success' : record.state.raw_value == 'assigned' ? 'info' : record.state.raw_value == 'expired' ? 'danger' : 'warning'}}">
                                    <field name="state"/>
                                </span>
                                <div class="text-muted small" t-if="record.assign_date.raw_value">
                                    Asignado: <field name="assign_date"/>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- 游댳 Vista 츼rbol -->
        <record id="view_service_credentials_list" model="ir.ui.view">
            <field name="name">service.credentials.list</field>
            <field name="model">service.credentials</field>
            <field name="arch" type="xml">
                <list string="Credenciales"
                      decoration-success="state == 'available'"
                      decoration-info="state == 'assigned'"
                      decoration-danger="state == 'expired'"
                      decoration-warning="state == 'pending_reset'">
                    <field name="product_id"/>
                    <field name="login"/>
                    <field name="password" password="True" optional="hide"/>
                    <field name="state" widget="badge"/>
                    <field name="partner_id" optional="hide"/>
                    <field name="assign_date" optional="show"/>
                    <field name="expire_date" optional="hide"/>
                </list>
            </field>
        </record>

        <!-- 游댳 Vista Formulario -->
        <record id="view_service_credentials_form" model="ir.ui.view">
            <field name="name">service.credentials.form</field>
            <field name="model">service.credentials</field>
            <field name="arch" type="xml">
                <form string="Credencial de servicio digital">
                    <header>
                        <button name="action_mark_pending_reset" string="Marcar para reinicio"
                                type="object" class="btn-warning" invisible="state != 'assigned'"/>
                        <button name="action_reset_account" string="Reiniciar cuenta"
                                type="object" class="btn-primary" invisible="state != 'pending_reset'"/>
                        <button name="action_mark_expired" string="Marcar como expirado"
                                type="object" class="btn-danger" invisible="state not in ('assigned','available')"/>
                        <button name="action_make_available" string="Marcar como disponible"
                                type="object" class="btn-success"
                                invisible="state not in ('expired','pending_reset') or sale_line_id"/>
                        <field name="state" widget="statusbar"
                               statusbar_visible="available,assigned,expired"/>
                    </header>

                    <sheet>
                        <group>
                            <group string="Informaci칩n del Servicio">
                                <field name="product_id" options="{'no_create': True}"/>
                                <field name="login"/>
                                <field name="password" password="True"/>
                            </group>

                            <group string="Asignaci칩n y Cliente">
                                <field name="assign_date" readonly="1"/>
                                <field name="expire_date"/>
                                <field name="partner_id" readonly="1"/>
                                <field name="sale_order_id" readonly="1"/>
                            </group>
                        </group>
                        <group string="Informaci칩n Adicional">
                            <field name="company_id" groups="base.group_multi_company"/>
                            <field name="notes"/>
                        </group>
                    </sheet>

                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- 游댳 Vista B칰squeda -->
<!-- 游댳 Vista B칰squeda -->
        <record id="view_service_credentials_search" model="ir.ui.view">
            <field name="name">service.credentials.search</field>
            <field name="model">service.credentials</field>
            <field name="arch" type="xml">
                <search string="Buscar Credenciales">
                    <field name="login" string="Usuario / Email"/>
                    <field name="product_id" string="Servicio"/>
                    <field name="partner_id" string="Cliente"/>
                    <field name="state" string="Estado"/>
        
                    <filter name="available" string="Disponibles" domain="[('state','=','available')]"/>
                    <filter name="assigned" string="Asignadas" domain="[('state','=','assigned')]"/>
                    <filter name="expired" string="Expiradas" domain="[('state','=','expired')]"/>
                    <filter name="pending_reset" string="Pendientes de reinicio" domain="[('state','=','pending_reset')]"/>
        
                    <group string="Agrupar por">
                        <filter name="group_service" string="Servicio" context="{'group_by': 'product_id'}"/>
                        <filter name="group_state" string="Estado" context="{'group_by': 'state'}"/>
                        <filter name="group_client" string="Cliente" context="{'group_by': 'partner_id'}"/>
                    </group>
                </search>
            </field>
        </record>
    </data>
</odoo>
